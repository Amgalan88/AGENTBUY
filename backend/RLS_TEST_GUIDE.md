# RLS –¢–µ—Å—Ç–ª—ç—Ö –ó–∞–∞–≤–∞—Ä

## ‚úÖ RLS –∏–¥—ç–≤—Ö–∂“Ø“Ø–ª—Å–Ω–∏–π –¥–∞—Ä–∞–∞ —Ö–∏–π—Ö –∑“Ø–π–ª—Å

### 1. Database —Ö–æ–ª–±–æ–ª—Ç —Ç–µ—Å—Ç–ª—ç—Ö

```bash
cd backend
node test-rls.js
```

–≠–Ω—ç script –Ω—å:
- ‚úÖ Database —Ö–æ–ª–±–æ–ª—Ç—ã–≥ —à–∞–ª–≥–∞–Ω–∞
- ‚úÖ –ë“Ø—Ö —Ö“Ø—Å–Ω—ç–≥—Ç—ç—ç—Å —É–Ω—à–∏—Ö –±–æ–ª–æ–º–∂—Ç–æ–π —ç—Å—ç—Ö–∏–π–≥ —Ç–µ—Å—Ç–ª—ç–Ω—ç
- ‚úÖ RLS policy-—É—É–¥ –∑”©–≤ –∞–∂–∏–ª–ª–∞–∂ –±–∞–π–≥–∞–∞ —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞–Ω–∞

**–•“Ø–ª—ç—ç–≥–¥—ç—Ö “Ø—Ä –¥“Ø–Ω:**
```
‚úÖ Database —Ö–æ–ª–±–æ–≥–¥—Å–æ–Ω
‚úÖ Settings —É–Ω—à–∏–≥–¥–ª–∞–∞
‚úÖ Users —É–Ω—à–∏–≥–¥–ª–∞–∞
‚úÖ Orders —É–Ω—à–∏–≥–¥–ª–∞–∞
...
üéâ –ë“Ø—Ö —Ç–µ—Å—Ç –∞–º–∂–∏–ª—Ç—Ç–∞–π!
```

### 2. Backend —Å–µ—Ä–≤–µ—Ä–∏–π–≥ —ç—Ö–ª“Ø“Ø–ª—ç—Ö

```bash
cd backend
npm run dev
```

**–®–∞–ª–≥–∞—Ö –∑“Ø–π–ª—Å:**
- ‚úÖ –°–µ—Ä–≤–µ—Ä —ç—Ö—ç–ª–∂ –±–∞–π–≥–∞–∞ —ç—Å—ç—Ö
- ‚úÖ Database —Ö–æ–ª–±–æ–≥–¥–æ–∂ –±–∞–π–≥–∞–∞ —ç—Å—ç—Ö
- ‚úÖ –Ø–º–∞—Ä —á –∞–ª–¥–∞–∞ –≥–∞—Ä—á –±–∞–π–≥–∞–∞ —ç—Å—ç—Ö

### 3. API endpoint-—É—É–¥—ã–≥ —Ç–µ—Å—Ç–ª—ç—Ö

Backend —ç—Ö—ç–ª—Å–Ω–∏–π –¥–∞—Ä–∞–∞ –¥–∞—Ä–∞–∞—Ö endpoint-—É—É–¥—ã–≥ —Ç–µ—Å—Ç–ª—ç—Ö:

**Settings:**
```bash
curl http://localhost:5000/api/settings
```

**Users (—Ö—ç—Ä—ç–≤ auth —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π –±–æ–ª):**
```bash
# Login —ç—Ö–ª—ç—ç–¥ —Ö–∏–π—Ö
```

**Orders:**
```bash
# Auth token —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π
```

## ‚ö†Ô∏è –•—ç—Ä—ç–≤ –∞–ª–¥–∞–∞ –≥–∞—Ä–≤–∞–ª

### –ê–ª–¥–∞–∞: "permission denied" —ç—Å–≤—ç–ª "row-level security policy"

**–®–∞–ª–≥–∞—Ö:**
1. Supabase SQL Editor –¥—ç—ç—Ä policy-—É—É–¥ “Ø“Ø—Å–≥—ç–≥–¥—Å—ç–Ω —ç—Å—ç—Ö:
   ```sql
   SELECT * FROM pg_policies WHERE schemaname = 'public';
   ```

2. RLS –∏–¥—ç–≤—Ö—Ç—ç–π —ç—Å—ç—Ö:
   ```sql
   SELECT tablename, rowsecurity 
   FROM pg_tables 
   WHERE schemaname = 'public' AND rowsecurity = true;
   ```

3. DATABASE_URL service_role key –∞–≥—É—É–ª–∂ –±–∞–π–≥–∞–∞ —ç—Å—ç—Ö:
   - –•—ç—Ä—ç–≤ `service_role` key –±–∞–π–≥–∞–∞ –±–æ–ª Prisma –∞–≤—Ç–æ–º–∞—Ç–∞–∞—Ä RLS-–∏–π–≥ bypass —Ö–∏–π—Ö
   - –•—ç—Ä—ç–≤ –±–∞–π—Ö–≥“Ø–π –±–æ–ª policy-—É—É–¥ —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π

### –ê–ª–¥–∞–∞: Connection error

**–®–∞–ª–≥–∞—Ö:**
- `.env` —Ñ–∞–π–ª–¥ `DATABASE_URL` –∑”©–≤ –±–∞–π–≥–∞–∞ —ç—Å—ç—Ö
- Supabase database –∞–∂–∏–ª–ª–∞–∂ –±–∞–π–≥–∞–∞ —ç—Å—ç—Ö
- Network connection –±–∞–π–≥–∞–∞ —ç—Å—ç—Ö

## üìã –î–∞—Ä–∞–∞–≥–∏–π–Ω –∞–ª—Ö–º—É—É–¥

1. ‚úÖ RLS –∏–¥—ç–≤—Ö–∂“Ø“Ø–ª—ç—Ö (–•–∏–π–≥–¥—Å—ç–Ω)
2. ‚úÖ Policy “Ø“Ø—Å–≥—ç—Ö (–•–∏–π–≥–¥—Å—ç–Ω)
3. ‚è≠Ô∏è Database —Ç–µ—Å—Ç–ª—ç—Ö (–û–¥–æ–æ —Ö–∏–π–∂ –±–∞–π–Ω–∞)
4. ‚è≠Ô∏è Backend —Ç–µ—Å—Ç–ª—ç—Ö
5. ‚è≠Ô∏è Production –¥—ç—ç—Ä deploy —Ö–∏–π—Ö

## üéØ –ê–º–∂–∏–ª—Ç—Ç–∞–π –±–æ–ª—Å–æ–Ω —ç—Å—ç—Ö

–•—ç—Ä—ç–≤ –±“Ø—Ö —Ç–µ—Å—Ç –∞–º–∂–∏–ª—Ç—Ç–∞–π –±–æ–ª:
- ‚úÖ RLS –∑”©–≤ —Ç–æ—Ö–∏—Ä—É—É–ª–∞–≥–¥—Å–∞–Ω
- ‚úÖ Backend database-—Ç–∞–π —Ö–æ–ª–±–æ–≥–¥–æ–∂ —á–∞–¥–Ω–∞
- ‚úÖ Production-–¥ deploy —Ö–∏–π–∂ –±–æ–ª–Ω–æ

