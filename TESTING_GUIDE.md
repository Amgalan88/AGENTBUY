# üß™ –ö–∞—Ä—Ç—ã–Ω —Å–∏—Å—Ç–µ–º–∏–π–Ω —Ç—É—Ä—à–∏–ª—Ç—ã–Ω –∑–∞–∞–≤–∞—Ä—á–∏–ª–≥–∞–∞

## üìã –¢—É—Ä—à–∏–ª—Ç—ã–Ω –¥–∞—Ä–∞–∞–ª–∞–ª

### 1. Backend —Å–µ—Ä–≤–µ—Ä–∏–π–≥ —ç—Ö–ª“Ø“Ø–ª—ç—Ö

```bash
cd backend
npm install  # –•—ç—Ä—ç–≤ —à–∏–Ω—ç dependencies –±–∞–π–≤–∞–ª
npm start
```

–≠—Å–≤—ç–ª PM2 –∞—à–∏–≥–ª–∞—Ö:
```bash
cd backend
npx pm2 start ecosystem.config.js
npx pm2 logs agentbuy
```

### 2. Frontend —Å–µ—Ä–≤–µ—Ä–∏–π–≥ —ç—Ö–ª“Ø“Ø–ª—ç—Ö

```bash
cd frontend
npm install  # –•—ç—Ä—ç–≤ —à–∏–Ω—ç dependencies –±–∞–π–≤–∞–ª
npm run dev
```

### 3. –ö–∞—Ä—Ç—ã–Ω —Å–∏—Å—Ç–µ–º–∏–π–Ω —Ç—É—Ä—à–∏–ª—Ç

#### ‚úÖ –¢–µ—Å—Ç 1: –ö–∞—Ä—Ç —Ö—É–¥–∞–ª–¥–∞–Ω –∞–≤–∞—Ö —Ö“Ø—Å—ç–ª—Ç “Ø“Ø—Å–≥—ç—Ö

1. –•—ç—Ä—ç–≥–ª—ç–≥—á—ç—ç—Ä –Ω—ç–≤—Ç—Ä—ç—Ö (`/auth/login`)
2. –ü—Ä–æ—Ñ–∞–π–ª —Ö—É—É–¥–∞—Å —Ä—É—É –æ—Ä–æ—Ö (`/user/profile`)
3. "–ö–∞—Ä—Ç –∞–≤–∞—Ö" —ç—Å–≤—ç–ª "‚ûï –ù—ç–º—ç–ª—Ç –∫–∞—Ä—Ç –∞–≤–∞—Ö" —Ç–æ–≤—á –¥–∞—Ä–∞—Ö
4. –ö–∞—Ä—Ç—ã–Ω —Ç–æ–æ –æ—Ä—É—É–ª–∞—Ö (–∂–∏—à—ç—ç: 5 –∫–∞—Ä—Ç)
5. –î–∞–Ω—Å–Ω—ã –º—ç–¥—ç—ç–ª—ç–ª –∞–≤—Ç–æ–º–∞—Ç–∞–∞—Ä –≥–∞—Ä—á –∏—Ä—ç—Ö —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö
6. "–¢”©–ª–±”©—Ä —Ç”©–ª—Å”©–Ω" —Ç–æ–≤—á –¥–∞—Ä–∞—Ö
7. ‚úÖ –•“Ø—Å—ç–ª—Ç –∞–º–∂–∏–ª—Ç—Ç–∞–π –∏–ª–≥—ç—ç–≥–¥—Å—ç–Ω —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö

#### ‚úÖ –¢–µ—Å—Ç 2: –ê–¥–º–∏–Ω –∫–∞—Ä—Ç—ã–Ω —Ö“Ø—Å—ç–ª—Ç–∏–π–≥ –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞—Ö

1. –ê–¥–º–∏–Ω —ç—Ä—Ö—ç—ç—Ä –Ω—ç–≤—Ç—Ä—ç—Ö (`/admin/login`)
2. –ê–¥–º–∏–Ω —Ö—É—É–¥–∞—Å –¥—ç—ç—Ä "–ö–∞—Ä—Ç—ã–Ω —Ö“Ø—Å—ç–ª—Ç" —Ö—ç—Å–≥–∏–π–≥ –æ–ª–æ—Ö
3. –•“Ø–ª—ç—ç–∂ –±–∞–π–≥–∞–∞ —Ö“Ø—Å—ç–ª—Ç“Ø“Ø–¥–∏–π–≥ —Ö–∞—Ä–∞—Ö
4. "–ë–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞—Ö" —Ç–æ–≤—á –¥–∞—Ä–∞—Ö
5. ‚úÖ –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –∫–∞—Ä—Ç—ã–Ω “Ø–ª–¥—ç–≥–¥—ç–ª –Ω—ç–º—ç–≥–¥—Å—ç–Ω —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö

#### ‚úÖ –¢–µ—Å—Ç 3: –ê–¥–º–∏–Ω —Ç”©–ª–±”©—Ä –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞—Ö–∞–¥ –∫–∞—Ä—Ç –±—É—Ü–∞–∞–Ω –æ–ª–≥–æ—Ö

1. –•—ç—Ä—ç–≥–ª—ç–≥—á—ç—ç—Ä –∑–∞—Ö–∏–∞–ª–≥–∞ “Ø“Ø—Å–≥—ç—Ö, –Ω–∏–π—Ç–ª—ç—Ö (1 –∫–∞—Ä—Ç —Ö—ç—Ä—ç–≥–ª—ç–Ω—ç)
2. –ê–≥–µ–Ω—Ç –∑–∞—Ö–∏–∞–ª–≥—ã–≥ –∞–≤–∞—Ö, –º—ç–¥—ç—ç–ª—ç–ª –æ—Ä—É—É–ª–∞—Ö
3. –ê–¥–º–∏–Ω —Ç”©–ª–±”©—Ä –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞—Ö (`/admin` —Ö—É—É–¥–∞—Å –¥—ç—ç—Ä)
4. ‚úÖ –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –∫–∞—Ä—Ç—ã–Ω “Ø–ª–¥—ç–≥–¥—ç–ª +1 –±–æ–ª—Å–æ–Ω —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö
5. ‚úÖ Transaction log –¥—ç—ç—Ä `return` type-—Ç–∞–π transaction –±–∞–π–≥–∞–∞ —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö

#### ‚úÖ –¢–µ—Å—Ç 4: 2 —É–¥–∞–∞ –∞–º–∂–∏–ª—Ç—Ç–∞–π –∑–∞—Ö–∏–∞–ª–≥–∞ —Ö–∏–π—Å—ç–Ω –±–æ–ª –±–æ–Ω—É—Å –∫–∞—Ä—Ç

1. –≠—Ö–Ω–∏–π –∑–∞—Ö–∏–∞–ª–≥–∞: –ê–¥–º–∏–Ω —Ç”©–ª–±”©—Ä –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞—Ö ‚Üí +1 –∫–∞—Ä—Ç (–±—É—Ü–∞–∞–ª—Ç)
2. –•–æ—ë—Ä –¥–∞—Ö—å –∑–∞—Ö–∏–∞–ª–≥–∞: –ê–¥–º–∏–Ω —Ç”©–ª–±”©—Ä –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞—Ö ‚Üí +1 –∫–∞—Ä—Ç (–±—É—Ü–∞–∞–ª—Ç) + 1 –∫–∞—Ä—Ç (–±–æ–Ω—É—Å) = +2 –∫–∞—Ä—Ç
3. ‚úÖ –•–æ—ë—Ä –¥–∞—Ö—å –∑–∞—Ö–∏–∞–ª–≥–∞–¥ –Ω–∏–π—Ç +2 –∫–∞—Ä—Ç –æ–ª–≥–æ–≥–¥—Å–æ–Ω —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö
4. ‚úÖ Transaction log –¥—ç—ç—Ä `bonus_card` type-—Ç–∞–π transaction –±–∞–π–≥–∞–∞ —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö

#### ‚úÖ –¢–µ—Å—Ç 5: Race condition –∑–∞—Å–≤–∞—Ä–ª–∞—Å–∞–Ω —ç—Å—ç—Ö

1. –û–ª–æ–Ω –∑–∞—Ö–∏–∞–ª–≥–∞ –Ω—ç–≥—ç–Ω –∑—ç—Ä—ç–≥ –Ω–∏–π—Ç–ª—ç—Ö (–ø–∞—Ä–∞–ª–ª–µ–ª—å request)
2. ‚úÖ –ö–∞—Ä—Ç—ã–Ω “Ø–ª–¥—ç–≥–¥—ç–ª –∑”©–≤ —Ç–æ–æ—Ü–æ–≥–¥—Å–æ–Ω —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö
3. ‚úÖ –î–∞—Ö–∏–Ω –æ—Ä–æ—Ö–æ–¥ –∫–∞—Ä—Ç –Ω—ç–º—ç–≥–¥—ç—ç–≥“Ø–π —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö

### 4. Database —à–∞–ª–≥–∞–ª—Ç

MongoDB –¥—ç—ç—Ä —à–∞–ª–≥–∞—Ö:

```javascript
// –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –∫–∞—Ä—Ç—ã–Ω “Ø–ª–¥—ç–≥–¥—ç–ª
db.users.findOne({ phone: "YOUR_PHONE" }, { cardBalance: 1, completedOrdersCount: 1 })

// –ö–∞—Ä—Ç—ã–Ω transaction-—É—É–¥
db.cardtransactions.find({ userId: ObjectId("USER_ID") }).sort({ createdAt: -1 })

// –ö–∞—Ä—Ç—ã–Ω —Ö“Ø—Å—ç–ª—Ç“Ø“Ø–¥
db.cardrequests.find().sort({ createdAt: -1 })
```

## üêõ –ê–ª–¥–∞–∞ –æ–ª–≤–æ–ª

1. **Backend console-–¥ –∞–ª–¥–∞–∞ –±–∞–π–≥–∞–∞ —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö**
2. **Browser console-–¥ –∞–ª–¥–∞–∞ –±–∞–π–≥–∞–∞ —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö (F12)**
3. **Network tab –¥—ç—ç—Ä API request-—É—É–¥—ã–≥ —à–∞–ª–≥–∞—Ö**
4. **MongoDB connection –∑”©–≤ —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö**

## üìù –¢—ç–º–¥—ç–≥–ª—ç–ª

- –ö–∞—Ä—Ç —Ö—É–¥–∞–ª–¥–∞–Ω –∞–≤–∞—Ö “Ø–Ω—ç: **2000‚ÇÆ / –∫–∞—Ä—Ç**
- –ê–º–∂–∏–ª—Ç—Ç–∞–π –∑–∞—Ö–∏–∞–ª–≥–∞ –±“Ø—Ä—Ç: **+1 –∫–∞—Ä—Ç** (–±—É—Ü–∞–∞–ª—Ç)
- 2, 4, 6, 8... —É–¥–∞–∞ –∞–º–∂–∏–ª—Ç—Ç–∞–π –∑–∞—Ö–∏–∞–ª–≥–∞: **+1 –∫–∞—Ä—Ç** (–±–æ–Ω—É—Å)

